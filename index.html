<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ğŸ›¢ï¸ Monitor Stok LPG Agen</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body class="bg-light">
  <div class="container py-5">
    <h1 class="text-center mb-4">ğŸ›¢ï¸ Monitor Stok LPG Agen</h1>
    <div id="stok-container" class="table-responsive"></div>
  </div>

  <script>
    async function fetchStok() {
      const container = document.getElementById('stok-container');
      container.innerHTML = '<p>ğŸ”„ Memuat data stok...</p>';

      try {
        const response = await fetch('https://map.pilex.xyz/api/stok'); // âœ… gunakan domain
        const data = await response.json();

        if (!data || Object.keys(data).length === 0) {
          container.innerHTML = '<p>â— Belum ada data stok tersimpan.</p>';
          return;
        }

        let html = `
          <table class="table table-bordered table-striped">
            <thead class="table-dark">
              <tr>
                <th>No</th>
                <th>No HP / Email</th>
                <th>Stok LPG 3kg</th>
                <th>Waktu Update</th>
              </tr>
            </thead>
            <tbody>
        `;

        let i = 1;
        for (const [akun, info] of Object.entries(data)) {
          html += `
            <tr>
              <td>${i++}</td>
              <td>${akun}</td>
              <td>${info.stok}</td>
              <td>${info.waktu}</td>
            </tr>
          `;
        }

        html += '</tbody></table>';
        container.innerHTML = html;
      } catch (error) {
        container.innerHTML = '<p class="text-danger">ğŸš« Gagal mengambil data stok. Pastikan server backend di <code>map.pilex.xyz</code> aktif dan dapat diakses.</p>';
        console.error(error);
      }
    }

    // ğŸ”„ Load pertama & refresh tiap 30 detik
    fetchStok();
    setInterval(fetchStok, 30000);
  </script>
</body>
</html>
